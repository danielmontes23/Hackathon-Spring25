---
import Layout from '../layouts/Layout.astro';
import '../styles/Global.css';
import DynamicResumeSections from '../components/DynamicResumeSections.jsx';
---

<Layout>
  <main style="max-width: 700px; margin: 2rem auto;">
    <h1>Resume Builder</h1>
    <form id="resume-form">
      <section>
        <h2>Personal Info</h2>
        <label>
          First Name:
          <input type="text" name="first_name" id="first_name" required />
        </label>
        <label>
          Last Name:
          <input type="text" name="last_name" id="last_name" required />
        </label>
        <label>
          Date of Birth:
          <input
            type="date"
            name="dob"
            id="dob"
            required
            max={new Date().toISOString().split('T')[0]} <!-- Prevents future dates --> 
        </label>
        <label>
          Email:
          <input type="email" name="email" id="email" required />
        </label>
        <label>
          Phone:
          <input
            type="tel"
            name="phone"
            id="phone"
            inputmode="tel"
            pattern="^\d{10,15}$"
            maxlength="15"
            title="Please enter a valid phone number (numbers only, 10-15 digits)"
          />
        </label>
      </section>

      <DynamicResumeSections client:load />

      <button type="submit">Generate Resume</button>
    </form>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const phoneInput = document.getElementById('phone');
        if (phoneInput) {
          phoneInput.addEventListener('input', () => {
            phoneInput.value = phoneInput.value.replace(/\D/g, '');
          });
        }

        ['first_name', 'last_name', 'email', 'phone'].forEach(field => {
          const input = document.getElementById(field);
          if (input) {
            // Load from localStorage
            const saved = localStorage.getItem(field);
            if (saved) input.value = saved;
            // Save on change
            input.addEventListener('input', () => {
              localStorage.setItem(field, input.value);
            });
          }
        });

        // Persist DOB
        const dobInput = document.getElementById('dob');
        if (dobInput) {
          const saved = localStorage.getItem('dob');
          if (saved) dobInput.value = saved;
          dobInput.addEventListener('input', () => {
            localStorage.setItem('dob', dobInput.value);
          });
        }
      });
    </script>
  </main>
</Layout>
